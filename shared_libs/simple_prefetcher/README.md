# Lib Predictor README
This library is designed to deduce per file descriptor access patterns and prefetch based on it.

It uses LD_PRELOAD to attach to the binary at runtime and injects the library code to the 
following commands in the app : fopen, fread, fwrite, open, read, write, fclose, close, pread
look at frontend.cpp



## About the access pattern detection:

The library keeps a HISTORY of read accesses for each file descriptor in the form of a bitarray.
Here, each bit represents PORTION_PAGES.

For a given read access from a program, the library will check NR_ADJACENT_CHECK adjacent bits
in front and back of that access. If the adjacent bits 

DEFNSEQ < LIKELYNSEQ < POSSNSEQ < MAYBESEQ < POSSSEQ < LIKELYSEQ < DEFSEQ


### Q1. How does it know if the app is seq or strided ?


### Q2. How does the library know when to prefetch ?


## Usage Info

### Q1. Compilation and Installation
To Compile `make -j8; make install`


### Q2. Types of shared libs and their usage

Prefetching switches:
1. Cross : Application using our crosslayer library
2. FileRA/BlockRA : prefetching is done using one readahead syscall or many small readahead syscalls
3. Pred/NoPred : Is the library doing prediction or no prediction before prefetching
4. MaxMem/Budget : Is the memory limited or not
5. BG/FG : Background/Foreground prefetching
6. info : use readahead_info to share page cache status using a bitmap

There are multiple preloadable files generated by the predictor library
1. lib_OSonly.so : Switch on only OS predictors
2. lib_CFNMB.so : Cross_FileRA_NoPred_MaxMem_BG
3. lib_CBNMB.so : Cross_BlockRA_NoPred_MaxMem_BG
4. lib_CFPMB.so : Cross_FileRA_Pred_MaxMem_BG
5. lib_CBPMB.so : Cross_BlockRA_Pred_MaxMem_BG
6. lib_CBNBB.so : Cross_BlockRA_NoPred_Budget_BG
7. lib_CBPBB.so : Cross_BlockRA_Pred_Budget_BG
8. lib_CBPBB_info.so : Cross_BlockRA_Pred_Budget_BG_info

To use any of the above `LD_PRELOAD=/usr/lib/libname.so <APP> <APP_FLAGS>`

Alternatively one could do : 
```
export LD_PRELOAD="/usr/lib/libname.so"
<APP> <APP_FLAGS>
export LD_PRELOAD=""
```

### Q3. Compile Time Flags and their Meanings:
1. NR_RA_PAGES : Number of pages to prefetch in one request when doing BlockRA
2. NR_WORKERS : Number of workers in threadpool doing all the prefetching.
3. PORTION_PAGES : Number of pages each bit in the bitarray represents.
4. MIN_FILE_SZ : Files smaller than these bytes will not be considered for prediction/prefetching
5. NR_ADJACENT_CHECK : Number of adjacent bits to check in bitarray to determine sequentiality


## TODO:
1. 
