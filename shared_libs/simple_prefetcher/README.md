# Lib Predictor README
This library is designed to deduce per file descriptor access patterns and prefetch based on it.

It uses LD_PRELOAD to attach to the binary at runtime and injects the library code to the 
following commands in the app : fopen, fread, fwrite, open, read, write, fclose, close, pread
look at frontend.cpp



## About the access pattern detection:

The library keeps a HISTORY of read accesses for each file descriptor in the form of a bitarray.
Here, each bit represents PORTION_PAGES.

For a given read access from a program, the library will check NR_ADJACENT_CHECK adjacent bits
in front and back of that access. If the adjacent bits 

DEFNSEQ < LIKELYNSEQ < POSSNSEQ < MAYBESEQ < POSSSEQ < LIKELYSEQ < DEFSEQ


### Q1. How does it know if the app is seq or strided ?


### Q2. How does the library know when to prefetch ?


## Usage Info

### Q1. Compilation and Installation
To Compile `make -j8; make install`


### Q2. Types of shared libs and their usage

Prefetching switches:
1. Cross : Application uses readahead_info to prefetch without predicting
2. Predict : enable prediction in library
3. Nolimit/Budget : enable evictions or not
4. IOOPT/VanillaIO : Enabled unbounded_read vs not
5. CacheOPT/Vanilla : enabled cache opt read vs not (Not implemented yet)



There are multiple preloadable files generated by the predictor library
1. lib_OSonly.so : Switch on only OS predictors
2. lib_Vanilla.so : Run the application as is. Nothing is changed
3. lib_Cross_Naive.so : use readahead_info without predicting. Fetch all files at open
4. lib_CNI.so : Cross_Naive + IOOPT
5. lib_CPNV.so : Cross_Predict_NoLimit_VanillaIO 
6. lib_CPNI.so : Cross_Predict_NoLimit_IOOPT
7. lib_CPBV.so : Cross_Predict_Budget_Vanilla
8. lib_CPBI.so : Cross_Predict_Budget_IOOPT


To use any of the above `LD_PRELOAD=/usr/lib/libname.so <APP> <APP_FLAGS>`

Alternatively one could do : 
```
export LD_PRELOAD="/usr/lib/libname.so"
<APP> <APP_FLAGS>
export LD_PRELOAD=""
```

### Q3. Compile Time Flags and their Meanings:
1. NR_RA_PAGES : Number of pages to prefetch in one request when doing BlockRA
2. NR_WORKERS : Number of workers in threadpool doing all the prefetching.
3. PORTION_PAGES : Number of pages each bit in the bitarray represents.
4. MIN_FILE_SZ : Files smaller than these bytes will not be considered for prediction/prefetching
5. NR_ADJACENT_CHECK : Number of adjacent bits to check in bitarray to determine sequentiality
